import secrets
import unittest

from parameterized import parameterized

from mantis.cipher import Mantis


class MantisTests(unittest.TestCase):
    @parameterized.expand([
        [
            '1001001011110000100110010101001011000110001001011110001111101001 \
             1101011110100000011000001111011100010100110000000010100100101011',
            '1011101010010001001011100110111100010000010101011111111011010010',
            '0011101101011100011101111010010010010010000111111001011100011000',
            '1101011001010010001000000011010111000001110000001100011011000001',
            5
        ],
        [
            '1001001011110000100110010101001011000110001001011110001111101001 \
             1101011110100000011000001111011100010100110000000010100100101011',
            '1011101010010001001011100110111100010000010101011111111011010010',
            '1101011001010010001000000011010111000001110000001100011011000001',
            '0110000011100100001101000101011100110001000110010011011011111101',
            6
        ],
        [
            '1001001011110000100110010101001011000110001001011110001111101001 \
             1101011110100000011000001111011100010100110000000010100100101011',
            '1011101010010001001011100110111100010000010101011111111011010010',
            '0110000011100100001101000101011100110001000110010011011011111101',
            '0011000010001110100010100000011111110001011010001111010100010111',
            7
        ],
        [
            '1001001011110000100110010101001011000110001001011110001111101001 \
             1101011110100000011000001111011100010100110000000010100100101011',
            '1011101010010001001011100110111100010000010101011111111011010010',
            '0011000010001110100010100000011111110001011010001111010100010111',
            '1001011100011110101000000001101010000110101101000001000010111011',
            8
        ]
    ])
    def test_encrypt(self, key: str, tweak: str, plaintext: str, ciphertext: str, nrounds: int):
        mantis = Mantis(4, 4, nrounds)
        self.assertEqual(ciphertext, mantis.encrypt(plaintext, key, tweak))

    def test_identity(self):
        plaintext = f'{secrets.randbits(64):064b}'
        key = f'{secrets.randbits(128):064b}'
        tweak = f'{secrets.randbits(64):064b}'

        mantis = Mantis(4, 4, 4)

        self.assertEqual(plaintext, mantis.decrypt(mantis.encrypt(plaintext, key, tweak), key, tweak))


if __name__ == '__main__':
    unittest.main()
